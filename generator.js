#!/usr/bin/env node
var w=Object.create;var m=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var E=(e,s,r,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of $(s))!S.call(e,t)&&t!==r&&m(e,t,{get:()=>s[t],enumerable:!(a=g(s,t))||a.enumerable});return e};var c=(e,s,r)=>(r=e!=null?w(z(e)):{},E(s||!e||!e.__esModule?m(r,"default",{value:e,enumerable:!0}):r,e));var d=c(require("path")),l=c(require("fs-extra")),p=c(require("knex"));process.stdout.write(process.platform==="win32"?"\x1B[2J\x1B[0f":"\x1B[2J\x1B[3J\x1B[H");function C(e,s){const r=e.split("(")[0],a=s==="YES";switch(r){case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"tinytext":case"text":case"mediumtext":case"longtext":case"json":case"decimal":return a?"z.string().nullish()":"z.string()";case"tinyint":case"smallint":case"mediumint":case"int":case"bigint":case"float":case"double":return a?"z.number().nullish()":"z.number()";case"enum":return`z.enum([${e.replace("enum(","").replace(")","").replaceAll(",",", ")}])`}}const i=l.default.readJSONSync(d.default.join(process.cwd(),"mysql-zod.json"));i.folder&&i.folder!==""&&l.default.emptyDirSync(i.folder);async function D(e){const s=(0,p.default)({client:"mysql2",connection:{host:e.host,port:e.port,user:e.user,password:e.password,database:e.database}});let a=(await s.raw("SELECT table_name FROM information_schema.tables WHERE table_schema = ?",[e.database]))[0].map(t=>t.table_name).filter(t=>!t.startsWith("knex_")).sort();e.tables&&e.tables.length&&(a=a.filter(t=>e.tables.includes(t))),e.ignore&&e.ignore.length&&(a=a.filter(t=>!e.ignore.includes(t)));for(const t of a){const f=(await s.raw(`DESC ${t}`))[0];let n=`import z from 'zod'

export const ${t} = z.object({`;for(const o of f){const x=o.Field,h=C(o.Type,o.Null);n=`${n}
  ${x}: ${h},`}n=`${n}
})
`;const b=e.folder&&e.folder!==""?e.folder:".",y=e.suffix&&e.suffix!==""?`${t}.${e.suffix}.ts`:`${t}.ts`,u=d.default.join(b,y);console.log("Created:",u),l.default.outputFileSync(u,n)}await s.destroy()}(async()=>await D(i))();
