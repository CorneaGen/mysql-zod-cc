#!/usr/bin/env node
var w=Object.create;var h=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var E=(e,s,a,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of S(s))!z.call(e,t)&&t!==a&&h(e,t,{get:()=>s[t],enumerable:!(n=$(s,t))||n.enumerable});return e};var u=(e,s,a)=>(a=e!=null?w(j(e)):{},E(s||!e||!e.__esModule?h(a,"default",{value:e,enumerable:!0}):a,e));var m=u(require("path")),c=u(require("fs-extra")),y=u(require("knex"));process.stdout.write(process.platform==="win32"?"\x1B[2J\x1B[0f":"\x1B[2J\x1B[3J\x1B[H");function v(e,s){const a=e.split("(")[0],n=s==="YES",t=["z.string()"],i=["z.number()"],o="nullish()",r="nonnegative()";switch(a){case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"tinytext":case"text":case"mediumtext":case"longtext":case"json":case"decimal":return n&&t.push(o),t.join(".");case"tinyint":case"smallint":case"mediumint":case"int":case"bigint":case"float":case"double":return e.endsWith(" unsigned")&&i.push(r),n&&i.push(o),i.join(".");case"enum":return`z.enum([${e.replace("enum(","").replace(")","").replaceAll(",",", ")}])`}}const l=c.default.readJSONSync(m.default.join(process.cwd(),"mysql-zod.json"));l.folder&&l.folder!==""&&c.default.emptyDirSync(l.folder);async function C(e){const s=(0,y.default)({client:"mysql2",connection:{host:e.host,port:e.port,user:e.user,password:e.password,database:e.database}});let n=(await s.raw("SELECT table_name FROM information_schema.tables WHERE table_schema = ?",[e.database]))[0].map(t=>t.table_name).filter(t=>!t.startsWith("knex_")).sort();e.tables&&e.tables.length&&(n=n.filter(t=>e.tables.includes(t))),e.ignore&&e.ignore.length&&(n=n.filter(t=>!e.ignore.includes(t)));for(const t of n){const o=(await s.raw(`DESC ${t}`))[0];let r=`import z from 'zod'

export const ${t} = z.object({`;for(const d of o){const g=d.Field,x=v(d.Type,d.Null);r=`${r}
  ${g}: ${x},`}r=`${r}
})
`;const p=e.folder&&e.folder!==""?e.folder:".",f=e.suffix&&e.suffix!==""?`${t}.${e.suffix}.ts`:`${t}.ts`,b=m.default.join(p,f);console.log("Created:",b),c.default.outputFileSync(b,r)}await s.destroy()}(async()=>await C(l))();
